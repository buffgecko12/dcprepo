CREATE OR REPLACE FUNCTION $APP_NAME$Views.SP_DCPUpsertSchoolReward (
	pSchoolId INTEGER,
	pRewardId INTEGER,
	pRewardIdList INTEGER[],
	pSchoolYear INTEGER,
	pRewardValue INTEGER
) 
RETURNS VOID AS $$
BEGIN   

	INSERT INTO $APP_NAME$.School_Reward(SchoolId, RewardId, SchoolYear, RewardValue)
	SELECT pSchoolId, r.RewardId, r.SchoolYear, COALESCE(pRewardValue, r.RewardValue)
	FROM $APP_NAME$Views.Reward r
	WHERE (
		r.RewardId = pRewardId OR -- Single reward
		r.RewardId = ANY(pRewardIdList) -- List of rewards
	)
	AND r.SchoolYear = pSchoolYear -- Make sure rewards are for given school year
	ON CONFLICT (SchoolId, RewardId) DO NOTHING
	;

END;
$$ LANGUAGE 'plpgsql';